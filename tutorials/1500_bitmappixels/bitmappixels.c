// 1500 BitmapPixels - Lissajous curve using bitmap mode
// Ported from OscarTutorials to F256K using f256lib

#include "f256lib.h"

// Pre-computed sin table: SinTab[i] = int(sin(i * PI / 128) * 256) for i=0..255
// Values range from -256 to 256.  cos(x) = SinTab[(x + 64) & 255].
static const int SinTab[256] = {
	   0,    6,   12,   18,   25,   31,   37,   43,
	  49,   56,   62,   68,   74,   80,   86,   92,
	  97,  103,  109,  115,  120,  126,  131,  136,
	 142,  147,  152,  157,  162,  167,  171,  176,
	 181,  185,  189,  193,  197,  201,  205,  209,
	 212,  216,  219,  222,  225,  228,  231,  234,
	 236,  238,  241,  243,  244,  246,  248,  249,
	 251,  252,  253,  254,  254,  255,  255,  255,
	 256,  255,  255,  255,  254,  254,  253,  252,
	 251,  249,  248,  246,  244,  243,  241,  238,
	 236,  234,  231,  228,  225,  222,  219,  216,
	 212,  209,  205,  201,  197,  193,  189,  185,
	 181,  176,  171,  167,  162,  157,  152,  147,
	 142,  136,  131,  126,  120,  115,  109,  103,
	  97,   92,   86,   80,   74,   68,   62,   56,
	  49,   43,   37,   31,   25,   18,   12,    6,
	   0,   -6,  -12,  -18,  -25,  -31,  -37,  -43,
	 -49,  -56,  -62,  -68,  -74,  -80,  -86,  -92,
	 -97, -103, -109, -115, -120, -126, -131, -136,
	-142, -147, -152, -157, -162, -167, -171, -176,
	-181, -185, -189, -193, -197, -201, -205, -209,
	-212, -216, -219, -222, -225, -228, -231, -234,
	-236, -238, -241, -243, -244, -246, -248, -249,
	-251, -252, -253, -254, -254, -255, -255, -255,
	-256, -255, -255, -255, -254, -254, -253, -252,
	-251, -249, -248, -246, -244, -243, -241, -238,
	-236, -234, -231, -228, -225, -222, -219, -216,
	-212, -209, -205, -201, -197, -193, -189, -185,
	-181, -176, -171, -167, -162, -157, -152, -147,
	-142, -136, -131, -126, -120, -115, -109, -103,
	 -97,  -92,  -86,  -80,  -74,  -68,  -62,  -56,
	 -49,  -43,  -37,  -31,  -25,  -18,  -12,   -6,
};

int main(int argc, char *argv[])
{
	// Enable bitmap mode
	POKE(VKY_MSTR_CTRL_0, PEEK(VKY_MSTR_CTRL_0) | VKY_GRAPH | VKY_BITMAP);
	bitmapSetVisible(0, true);

	// Set up a simple grayscale CLUT for plotting
	graphicsDefineColor(0, 0, 0, 0, 0);       // black background
	graphicsDefineColor(0, 1, 255, 255, 255);  // white pixel

	graphicsSetBorderC64Color(1);
	bitmapSetActive(0);
	bitmapSetColor(0);
	bitmapClear();
	bitmapSetColor(1);

	byte w = 0;
	byte phase = 0;
	for (;;)
	{
		int x = 160 + SinTab[(w + 64) & 255] * 80 / 256
		            + SinTab[(w * 5 + phase + 64) & 255] * 20 / 256
		            + SinTab[(w * 13 + 64) & 255] * 10 / 256;
		int y = 120 + SinTab[(w * 2 + phase) & 255] * 80 / 256
		            + SinTab[(w * 7) & 255] * 20 / 256
		            + SinTab[(w * 11) & 255] * 10 / 256;

		bitmapPutPixel((uint16_t)x, (uint16_t)y);
		if (++w == 0) phase++;
	}

	return 0;
}
