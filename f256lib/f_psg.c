/*
 *	PSG (Programmable Sound Generator) support for F256.
 *	Adapted from mu0nlibs/mupsg for oscar64.
 */


#ifndef WITHOUT_PSG


#include "f256lib.h"


const byte psgLow[64] = {
	0x86, 0x8d, 0x87, 0x84, 0x84, 0x87, 0x8d, 0x84, 0x8e, 0x8b, 0x89, 0x89,
	0x8b, 0x8e, 0x83, 0x8a, 0x82, 0x8b, 0x86, 0x82, 0x8f, 0x8d, 0x8c, 0x8c,
	0x8d, 0x8f, 0x81, 0x85, 0x89, 0x8d, 0x83, 0x89, 0x8f, 0x86, 0x8e, 0x86,
	0x8e, 0x87, 0x80, 0x8a, 0x84, 0x8e, 0x89, 0x84, 0x8f, 0x8b, 0x87, 0x83,
	0x8f, 0x8b, 0x88, 0x85, 0x82, 0x8f, 0x8c, 0x8a, 0x87, 0x85, 0x83, 0x81,
	0x8f, 0x8d, 0x8c, 0x8a
};

const byte psgHigh[64] = {
	0x3f, 0x3b, 0x38, 0x35, 0x32, 0x2f, 0x2c, 0x2a, 0x27, 0x25, 0x23, 0x21,
	0x1f, 0x1d, 0x1c, 0x1a, 0x19, 0x17, 0x16, 0x15, 0x13, 0x12, 0x11, 0x10,
	0x0f, 0x0e, 0x0e, 0x0d, 0x0c, 0x0b, 0x0b, 0x0a, 0x09, 0x09, 0x08, 0x08,
	0x07, 0x07, 0x07, 0x06, 0x06, 0x05, 0x05, 0x05, 0x04, 0x04, 0x04, 0x04,
	0x03, 0x03, 0x03, 0x03, 0x03, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02,
	0x01, 0x01, 0x01, 0x01
};


void psgShut(void) {
	byte i;
	for (i = 1; i <= 7; i += 2) {
		POKE(VKY_PSG0, 0x9F | (i << 4));
		POKE(VKY_PSG1, 0x9F | (i << 4));
	}
}


void psgNoteOn(byte chan, uint16_t addr, byte loByte, byte hiByte, byte velocity) {
	POKE(addr, 0x90 | chan | (~((velocity >> 3))) & 0x0F);
	POKE(addr, loByte | chan);
	POKE(addr, hiByte);
}


void psgNoteOff(byte chan, uint16_t addr) {
	POKE(addr, 0x9F | chan);
}


void psgSetMono(void) {
	byte sys1 = PEEK(VKY_SYS1);
	sys1 = sys1 & 0xFB;
	POKE(VKY_SYS1, sys1);
}


void psgSetStereo(void) {
	byte sys1 = PEEK(VKY_SYS1);
	sys1 = sys1 | 0x04;
	POKE(VKY_SYS1, sys1);
}


#endif
